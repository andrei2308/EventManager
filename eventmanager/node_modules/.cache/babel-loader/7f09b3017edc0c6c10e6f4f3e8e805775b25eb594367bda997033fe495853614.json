{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nexports.__esModule = true;\nvar ajv_1 = require(\"ajv\");\nvar ajv_formats_1 = require(\"ajv-formats\");\nvar openapi_jsonschema_parameters_1 = require(\"openapi-jsonschema-parameters\");\nvar ts_log_1 = require(\"ts-log\");\nvar contentTypeParser = require('content-type');\nvar LOCAL_DEFINITION_REGEX = /^#\\/([^\\/]+)\\/([^\\/]+)$/;\nvar OpenAPIRequestValidator = /** @class */function () {\n  function OpenAPIRequestValidator(args) {\n    var _this = this;\n    this.logger = ts_log_1.dummyLogger;\n    this.loggingKey = '';\n    this.requestBodyValidators = {};\n    this.enableHeadersLowercase = true;\n    var loggingKey = args && args.loggingKey ? args.loggingKey + ': ' : '';\n    this.loggingKey = loggingKey;\n    if (!args) {\n      throw new Error(\"\".concat(loggingKey, \"missing args argument\"));\n    }\n    if (args.logger) {\n      this.logger = args.logger;\n    }\n    if (args.hasOwnProperty('enableHeadersLowercase')) {\n      this.enableHeadersLowercase = args.enableHeadersLowercase;\n    }\n    var errorTransformer = typeof args.errorTransformer === 'function' && args.errorTransformer;\n    var errorMapper = errorTransformer ? extendedErrorMapper(errorTransformer) : toOpenapiValidationError;\n    var bodyValidationSchema;\n    var bodySchema;\n    var headersSchema;\n    var formDataSchema;\n    var pathSchema;\n    var querySchema;\n    var isBodyRequired;\n    if (args.parameters !== undefined) {\n      if (Array.isArray(args.parameters)) {\n        var schemas = (0, openapi_jsonschema_parameters_1.convertParametersToJSONSchema)(args.parameters);\n        bodySchema = schemas.body;\n        headersSchema = lowercasedHeaders(schemas.headers, this.enableHeadersLowercase);\n        formDataSchema = schemas.formData;\n        pathSchema = schemas.path;\n        if (schemas.query && args.hasOwnProperty('additionalQueryProperties')) {\n          schemas.query.additionalProperties = args.additionalQueryProperties;\n        }\n        querySchema = schemas.query;\n        isBodyRequired =\n        // @ts-ignore\n        args.parameters.filter(byRequiredBodyParameters).length > 0;\n      } else {\n        throw new Error(\"\".concat(loggingKey, \"args.parameters must be an Array\"));\n      }\n    }\n    var v = new ajv_1[\"default\"](__assign({\n      useDefaults: true,\n      allErrors: true,\n      strict: false,\n      // @ts-ignore TODO get Ajv updated to account for logger\n      logger: false\n    }, args.ajvOptions || {}));\n    (0, ajv_formats_1[\"default\"])(v);\n    v.removeKeyword('readOnly');\n    v.addKeyword({\n      keyword: 'readOnly',\n      modifying: true,\n      compile: function (sch) {\n        if (sch) {\n          return function validate(data, dataCtx) {\n            validate.errors = [{\n              keyword: 'readOnly',\n              instancePath: dataCtx.instancePath,\n              message: 'is read-only',\n              params: {\n                readOnly: dataCtx.parentDataProperty\n              }\n            }];\n            return !(sch === true && data !== null);\n          };\n        }\n        return function () {\n          return true;\n        };\n      }\n    });\n    if (args.requestBody) {\n      isBodyRequired = args.requestBody.required || false;\n    }\n    if (args.customFormats) {\n      var hasNonFunctionProperty_1;\n      Object.keys(args.customFormats).forEach(function (format) {\n        var func = args.customFormats[format];\n        if (typeof func === 'function') {\n          v.addFormat(format, func);\n        } else {\n          hasNonFunctionProperty_1 = true;\n        }\n      });\n      if (hasNonFunctionProperty_1) {\n        throw new Error(\"\".concat(loggingKey, \"args.customFormats properties must be functions\"));\n      }\n    }\n    if (args.customKeywords) {\n      for (var _i = 0, _a = Object.entries(args.customKeywords); _i < _a.length; _i++) {\n        var _b = _a[_i],\n          keywordName = _b[0],\n          keywordDefinition = _b[1];\n        v.addKeyword(__assign({\n          keyword: keywordName\n        }, keywordDefinition));\n      }\n    }\n    if (bodySchema) {\n      bodyValidationSchema = {\n        properties: {\n          body: bodySchema\n        }\n      };\n    }\n    if (args.componentSchemas) {\n      // openapi v3:\n      Object.keys(args.componentSchemas).forEach(function (id) {\n        v.addSchema(args.componentSchemas[id], \"#/components/schemas/\".concat(id));\n        _this.addSchemaProperties(v, args.componentSchemas[id], \"#/components/schemas/\".concat(id));\n      });\n    } else if (args.schemas) {\n      if (Array.isArray(args.schemas)) {\n        args.schemas.forEach(function (schema) {\n          var id = schema.id;\n          if (id) {\n            var localSchemaPath = LOCAL_DEFINITION_REGEX.exec(id);\n            if (localSchemaPath && bodyValidationSchema) {\n              var definitions = bodyValidationSchema[localSchemaPath[1]];\n              if (!definitions) {\n                definitions = bodyValidationSchema[localSchemaPath[1]] = {};\n              }\n              definitions[localSchemaPath[2]] = schema;\n            }\n            // backwards compatibility with json-schema-draft-04\n            delete schema.id;\n            v.addSchema(__assign({\n              $id: id\n            }, schema), id);\n          } else {\n            _this.logger.warn(loggingKey, 'igorning schema without id property');\n          }\n        });\n      } else if (bodySchema) {\n        bodyValidationSchema.definitions = args.schemas;\n        bodyValidationSchema.components = {\n          schemas: args.schemas\n        };\n      }\n    }\n    if (args.externalSchemas) {\n      Object.keys(args.externalSchemas).forEach(function (id) {\n        v.addSchema(args.externalSchemas[id], id);\n      });\n    }\n    if (args.requestBody) {\n      /* tslint:disable-next-line:forin */\n      for (var mediaTypeKey in args.requestBody.content) {\n        var bodyContentSchema = args.requestBody.content[mediaTypeKey].schema;\n        var copied = JSON.parse(JSON.stringify(bodyContentSchema));\n        var resolvedSchema = resolveAndSanitizeRequestBodySchema(copied, v);\n        this.requestBodyValidators[mediaTypeKey] = v.compile(transformOpenAPIV3Definitions({\n          properties: {\n            body: resolvedSchema\n          },\n          definitions: args.schemas || {},\n          components: {\n            schemas: args.schemas\n          }\n        }));\n      }\n    }\n    this.bodySchema = bodySchema;\n    this.errorMapper = errorMapper;\n    this.isBodyRequired = isBodyRequired;\n    this.requestBody = args.requestBody;\n    this.validateBody = bodyValidationSchema && v.compile(transformOpenAPIV3Definitions(bodyValidationSchema));\n    this.validateFormData = formDataSchema && v.compile(transformOpenAPIV3Definitions(formDataSchema));\n    this.validateHeaders = headersSchema && v.compile(transformOpenAPIV3Definitions(headersSchema));\n    this.validatePath = pathSchema && v.compile(transformOpenAPIV3Definitions(pathSchema));\n    this.validateQuery = querySchema && v.compile(transformOpenAPIV3Definitions(querySchema));\n  }\n  OpenAPIRequestValidator.prototype.validateRequest = function (request) {\n    var errors = [];\n    var err;\n    var schemaError;\n    var mediaTypeError;\n    if (this.bodySchema) {\n      if (request.body) {\n        if (!this.validateBody({\n          body: request.body\n        })) {\n          errors.push.apply(errors, withAddedLocation('body', this.validateBody.errors));\n        }\n      } else if (this.isBodyRequired) {\n        schemaError = {\n          location: 'body',\n          message: 'request.body was not present in the request.  Is a body-parser being used?',\n          schema: this.bodySchema\n        };\n      }\n    }\n    if (this.requestBody) {\n      var contentType = getHeaderValue(request.headers, 'content-type');\n      var mediaTypeMatch = getSchemaForMediaType(contentType, this.requestBody, this.logger, this.loggingKey);\n      if (!mediaTypeMatch) {\n        if (contentType) {\n          mediaTypeError = {\n            message: \"Unsupported Content-Type \".concat(contentType)\n          };\n        } else if (this.isBodyRequired) {\n          errors.push({\n            keyword: 'required',\n            instancePath: '/body',\n            params: {},\n            message: 'media type is not specified',\n            location: 'body'\n          });\n        }\n      } else {\n        var bodySchema = this.requestBody.content[mediaTypeMatch].schema;\n        if (request.body) {\n          var validateBody = this.requestBodyValidators[mediaTypeMatch];\n          if (!validateBody({\n            body: request.body\n          })) {\n            errors.push.apply(errors, withAddedLocation('body', validateBody.errors));\n          }\n        } else if (this.isBodyRequired) {\n          schemaError = {\n            location: 'body',\n            message: 'request.body was not present in the request.  Is a body-parser being used?',\n            schema: bodySchema\n          };\n        }\n      }\n    }\n    if (this.validateFormData && !schemaError) {\n      if (!this.validateFormData(request.body)) {\n        errors.push.apply(errors, withAddedLocation('formData', this.validateFormData.errors));\n      }\n    }\n    if (this.validatePath) {\n      if (!this.validatePath(request.params || {})) {\n        errors.push.apply(errors, withAddedLocation('path', this.validatePath.errors));\n      }\n    }\n    if (this.validateHeaders) {\n      if (!this.validateHeaders(lowercaseRequestHeaders(request.headers || {}, this.enableHeadersLowercase))) {\n        errors.push.apply(errors, withAddedLocation('headers', this.validateHeaders.errors));\n      }\n    }\n    if (this.validateQuery) {\n      if (!this.validateQuery(request.query || {})) {\n        errors.push.apply(errors, withAddedLocation('query', this.validateQuery.errors));\n      }\n    }\n    if (errors.length) {\n      err = {\n        status: 400,\n        errors: errors.map(this.errorMapper)\n      };\n    } else if (schemaError) {\n      err = {\n        status: 400,\n        errors: [schemaError]\n      };\n    } else if (mediaTypeError) {\n      err = {\n        status: 415,\n        errors: [mediaTypeError]\n      };\n    }\n    return err;\n  };\n  OpenAPIRequestValidator.prototype.validate = function (request) {\n    console.warn('validate is deprecated, use validateRequest instead.');\n    this.validateRequest(request);\n  };\n  OpenAPIRequestValidator.prototype.addSchemaProperties = function (v, schema, prefix) {\n    for (var attr in schema) {\n      if (schema.hasOwnProperty(attr)) {\n        switch (attr) {\n          case 'allOf':\n          case 'oneOf':\n          case 'anyOf':\n            for (var i = 0; i < schema[attr].length; i++) {\n              this.addSchemaProperties(v, schema[attr][i], \"\".concat(prefix, \"/\").concat(attr, \"/\").concat(i));\n            }\n            return;\n          case 'items':\n            this.addSchemaProperties(v, schema[attr], \"\".concat(prefix, \"/\").concat(attr));\n            return;\n          case 'properties':\n            for (var propertyId in schema[attr]) {\n              if (schema[attr].hasOwnProperty(propertyId)) {\n                var schemaId = \"\".concat(prefix, \"/\").concat(attr, \"/\").concat(propertyId);\n                v.addSchema(schema[attr][propertyId], schemaId);\n                this.addSchemaProperties(v, schema[attr][propertyId], schemaId);\n              }\n            }\n            return;\n        }\n      }\n    }\n  };\n  return OpenAPIRequestValidator;\n}();\nexports[\"default\"] = OpenAPIRequestValidator;\nfunction byRequiredBodyParameters(param) {\n  // @ts-ignore\n  return (param[\"in\"] === 'body' || param[\"in\"] === 'formData') && param.required;\n}\nfunction extendedErrorMapper(mapper) {\n  return function (ajvError) {\n    return mapper(toOpenapiValidationError(ajvError), ajvError);\n  };\n}\nfunction getSchemaForMediaType(contentTypeHeader, requestBodySpec, logger, loggingKey) {\n  if (!contentTypeHeader) {\n    return;\n  }\n  var contentType;\n  try {\n    contentType = contentTypeParser.parse(contentTypeHeader).type;\n  } catch (e) {\n    logger.warn(loggingKey, 'failed to parse content-type', contentTypeHeader, e);\n    if (e instanceof TypeError && e.message === 'invalid media type') {\n      return;\n    }\n    throw e;\n  }\n  var content = requestBodySpec.content;\n  var subTypeWildCardPoints = 2;\n  var wildcardMatchPoints = 1;\n  var match;\n  var matchPoints = 0;\n  for (var mediaTypeKey in content) {\n    if (content.hasOwnProperty(mediaTypeKey)) {\n      if (mediaTypeKey.indexOf(contentType) > -1) {\n        return mediaTypeKey;\n      } else if (mediaTypeKey === '*/*' && wildcardMatchPoints > matchPoints) {\n        match = mediaTypeKey;\n        matchPoints = wildcardMatchPoints;\n      }\n      var contentTypeParts = contentType.split('/');\n      var mediaTypeKeyParts = mediaTypeKey.split('/');\n      if (mediaTypeKeyParts[1] !== '*') {\n        continue;\n      } else if (contentTypeParts[0] === mediaTypeKeyParts[0] && subTypeWildCardPoints > matchPoints) {\n        match = mediaTypeKey;\n        matchPoints = subTypeWildCardPoints;\n      }\n    }\n  }\n  return match;\n}\nfunction lowercaseRequestHeaders(headers, enableHeadersLowercase) {\n  if (enableHeadersLowercase) {\n    var lowerCasedHeaders_1 = {};\n    Object.keys(headers).forEach(function (header) {\n      lowerCasedHeaders_1[header.toLowerCase()] = headers[header];\n    });\n    return lowerCasedHeaders_1;\n  } else {\n    return headers;\n  }\n}\nfunction lowercasedHeaders(headersSchema, enableHeadersLowercase) {\n  if (headersSchema && enableHeadersLowercase) {\n    var properties_1 = headersSchema.properties;\n    Object.keys(properties_1).forEach(function (header) {\n      var property = properties_1[header];\n      delete properties_1[header];\n      properties_1[header.toLowerCase()] = property;\n    });\n    if (headersSchema.required && headersSchema.required.length) {\n      headersSchema.required = headersSchema.required.map(function (header) {\n        return header.toLowerCase();\n      });\n    }\n  }\n  return headersSchema;\n}\nfunction toOpenapiValidationError(error) {\n  var validationError = {\n    path: 'instance' + error.instancePath,\n    errorCode: \"\".concat(error.keyword, \".openapi.requestValidation\"),\n    message: error.message,\n    location: error.location\n  };\n  if (error.keyword === '$ref') {\n    delete validationError.errorCode;\n    validationError.schema = {\n      $ref: error.params.ref\n    };\n  }\n  if (error.params.missingProperty) {\n    validationError.path += '/' + error.params.missingProperty;\n  }\n  validationError.path = validationError.path.replace(error.location === 'body' ? /^instance\\/body\\/?/ : /^instance\\/?/, '');\n  validationError.path = validationError.path.replace(/\\//g, '.');\n  if (!validationError.path) {\n    delete validationError.path;\n  }\n  return stripBodyInfo(validationError);\n}\nfunction stripBodyInfo(error) {\n  if (error.location === 'body') {\n    if (typeof error.path === 'string') {\n      error.path = error.path.replace(/^body\\./, '');\n    } else {\n      // Removing to avoid breaking clients that are expecting strings.\n      delete error.path;\n    }\n    error.message = error.message.replace(/^instance\\.body\\./, 'instance.');\n  }\n  return error;\n}\nfunction withAddedLocation(location, errors) {\n  errors.forEach(function (error) {\n    error.location = location;\n  });\n  return errors;\n}\nfunction resolveAndSanitizeRequestBodySchema(requestBodySchema, v) {\n  var resolved;\n  var copied;\n  if ('properties' in requestBodySchema) {\n    var schema_1 = requestBodySchema;\n    Object.keys(schema_1.properties).forEach(function (property) {\n      var prop = schema_1.properties[property];\n      prop = sanitizeReadonlyPropertiesFromRequired(prop);\n      if (!prop.hasOwnProperty('$ref') && !prop.hasOwnProperty('items')) {\n        prop = resolveAndSanitizeRequestBodySchema(prop, v);\n      }\n    });\n    requestBodySchema = sanitizeReadonlyPropertiesFromRequired(requestBodySchema);\n  } else if ('$ref' in requestBodySchema) {\n    resolved = v.getSchema(requestBodySchema.$ref);\n    if (resolved && resolved.schema) {\n      copied = JSON.parse(JSON.stringify(resolved.schema));\n      copied = sanitizeReadonlyPropertiesFromRequired(copied);\n      copied = resolveAndSanitizeRequestBodySchema(copied, v);\n      requestBodySchema = copied;\n    }\n  } else if ('items' in requestBodySchema) {\n    if ('$ref' in requestBodySchema.items) {\n      resolved = v.getSchema(requestBodySchema.items.$ref);\n      if (resolved && resolved.schema) {\n        copied = JSON.parse(JSON.stringify(resolved.schema));\n        copied = sanitizeReadonlyPropertiesFromRequired(copied);\n        copied = resolveAndSanitizeRequestBodySchema(copied, v);\n        requestBodySchema.items = copied;\n      }\n    }\n  } else if ('allOf' in requestBodySchema) {\n    requestBodySchema.allOf = requestBodySchema.allOf.map(function (val) {\n      val = sanitizeReadonlyPropertiesFromRequired(val);\n      return resolveAndSanitizeRequestBodySchema(val, v);\n    });\n  } else if ('oneOf' in requestBodySchema) {\n    requestBodySchema.oneOf = requestBodySchema.oneOf.map(function (val) {\n      val = sanitizeReadonlyPropertiesFromRequired(val);\n      return resolveAndSanitizeRequestBodySchema(val, v);\n    });\n  } else if ('anyOf' in requestBodySchema) {\n    requestBodySchema.anyOf = requestBodySchema.anyOf.map(function (val) {\n      val = sanitizeReadonlyPropertiesFromRequired(val);\n      return resolveAndSanitizeRequestBodySchema(val, v);\n    });\n  }\n  return requestBodySchema;\n}\nfunction sanitizeReadonlyPropertiesFromRequired(schema) {\n  if ('properties' in schema && 'required' in schema) {\n    var readOnlyProps = Object.keys(schema.properties).map(function (key) {\n      var prop = schema.properties[key];\n      if (prop && 'readOnly' in prop) {\n        if (prop.readOnly === true) {\n          return key;\n        }\n      }\n      return;\n    });\n    readOnlyProps.filter(function (i) {\n      return i !== undefined;\n    }).forEach(function (value) {\n      var index = schema.required.indexOf(value);\n      if (index !== -1) {\n        schema.required.splice(index, 1);\n      }\n    });\n  }\n  return schema;\n}\nfunction recursiveTransformOpenAPIV3Definitions(object) {\n  // Transformations //\n  // OpenAPIV3 nullable\n  if (object.nullable === true) {\n    if (object[\"enum\"]) {\n      // Enums can not be null with type null\n      object.oneOf = [{\n        type: 'null'\n      }, {\n        type: object.type,\n        \"enum\": object[\"enum\"]\n      }];\n      delete object.type;\n      delete object[\"enum\"];\n    } else if (object.type) {\n      object.type = [object.type, 'null'];\n    } else if (object.allOf) {\n      object.anyOf = [{\n        allOf: object.allOf\n      }, {\n        type: 'null'\n      }];\n      delete object.allOf;\n    } else if (object.oneOf || object.anyOf) {\n      var arr = object.oneOf || object.anyOf;\n      arr.push({\n        type: 'null'\n      });\n    }\n    delete object.nullable;\n  }\n  Object.keys(object).forEach(function (attr) {\n    if (typeof object[attr] === 'object' && object[attr] !== null) {\n      recursiveTransformOpenAPIV3Definitions(object[attr]);\n    } else if (Array.isArray(object[attr])) {\n      object[attr].forEach(function (obj) {\n        return recursiveTransformOpenAPIV3Definitions(obj);\n      });\n    }\n  });\n}\nfunction transformOpenAPIV3Definitions(schema) {\n  if (typeof schema !== 'object') {\n    return schema;\n  }\n  var res = JSON.parse(JSON.stringify(schema));\n  recursiveTransformOpenAPIV3Definitions(res);\n  return res;\n}\nfunction getHeaderValue(requestHeaders, header) {\n  var matchingHeaders = Object.keys(requestHeaders).filter(function (key) {\n    return key.toLowerCase() === header.toLowerCase();\n  });\n  return requestHeaders[matchingHeaders[0]];\n}","map":{"version":3,"names":["ajv_1","require","ajv_formats_1","openapi_jsonschema_parameters_1","ts_log_1","contentTypeParser","LOCAL_DEFINITION_REGEX","OpenAPIRequestValidator","args","_this","logger","dummyLogger","loggingKey","requestBodyValidators","enableHeadersLowercase","Error","concat","hasOwnProperty","errorTransformer","errorMapper","extendedErrorMapper","toOpenapiValidationError","bodyValidationSchema","bodySchema","headersSchema","formDataSchema","pathSchema","querySchema","isBodyRequired","parameters","undefined","Array","isArray","schemas","convertParametersToJSONSchema","body","lowercasedHeaders","headers","formData","path","query","additionalProperties","additionalQueryProperties","filter","byRequiredBodyParameters","length","v","__assign","useDefaults","allErrors","strict","ajvOptions","removeKeyword","addKeyword","keyword","modifying","compile","sch","validate","data","dataCtx","errors","instancePath","message","params","readOnly","parentDataProperty","requestBody","required","customFormats","hasNonFunctionProperty_1","Object","keys","forEach","format","func","addFormat","customKeywords","_i","_a","entries","_b","keywordName","keywordDefinition","properties","componentSchemas","id","addSchema","addSchemaProperties","schema","localSchemaPath","exec","definitions","$id","warn","components","externalSchemas","mediaTypeKey","content","bodyContentSchema","copied","JSON","parse","stringify","resolvedSchema","resolveAndSanitizeRequestBodySchema","transformOpenAPIV3Definitions","validateBody","validateFormData","validateHeaders","validatePath","validateQuery","prototype","validateRequest","request","err","schemaError","mediaTypeError","push","apply","withAddedLocation","location","contentType","getHeaderValue","mediaTypeMatch","getSchemaForMediaType","lowercaseRequestHeaders","status","map","console","prefix","attr","i","propertyId","schemaId","param","mapper","ajvError","contentTypeHeader","requestBodySpec","type","e","TypeError","subTypeWildCardPoints","wildcardMatchPoints","match","matchPoints","indexOf","contentTypeParts","split","mediaTypeKeyParts","lowerCasedHeaders_1","header","toLowerCase","properties_1","property","error","validationError","errorCode","$ref","ref","missingProperty","replace","stripBodyInfo","requestBodySchema","resolved","schema_1","prop","sanitizeReadonlyPropertiesFromRequired","getSchema","items","allOf","val","oneOf","anyOf","readOnlyProps","key","value","index","splice","recursiveTransformOpenAPIV3Definitions","object","nullable","arr","obj","res","requestHeaders","matchingHeaders"],"sources":["../index.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}